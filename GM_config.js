function GM_configStruct(){arguments.length&&(GM_configInit(this,arguments),this.onInit())}function GM_configInit(e,t){if(void 0===e.fields&&(e.fields={},e.onInit=e.onInit||function(){},e.onOpen=e.onOpen||function(){},e.onSave=e.onSave||function(){},e.onClose=e.onClose||function(){},e.onReset=e.onReset||function(){},e.isOpen=!1,e.title="User Script Settings",e.css={basic:["#GM_config * { font-family: arial,tahoma,myriad pro,sans-serif; }","#GM_config { background: #FFF; }","#GM_config input[type='radio'] { margin-right: 8px; }","#GM_config .indent40 { margin-left: 40%; }","#GM_config .field_label { font-size: 12px; font-weight: bold; margin-right: 6px; }","#GM_config .radio_label { font-size: 12px; }","#GM_config .block { display: block; }","#GM_config .saveclose_buttons { margin: 16px 10px 10px; padding: 2px 12px; }","#GM_config .reset, #GM_config .reset a, #GM_config_buttons_holder { color: #000; text-align: right; }","#GM_config .config_header { font-size: 20pt; margin: 0; }","#GM_config .config_desc, #GM_config .section_desc, #GM_config .reset { font-size: 9pt; }","#GM_config .center { text-align: center; }","#GM_config .section_header_holder { margin-top: 8px; }","#GM_config .config_var { margin: 0 0 4px; }","#GM_config .section_header { background: #414141; border: 1px solid #000; color: #FFF;"," font-size: 13pt; margin: 0; }","#GM_config .section_desc { background: #EFEFEF; border: 1px solid #CCC; color: #575757; font-size: 9pt; margin: 0 0 6px; }"].join("\n")+"\n",basicPrefix:"GM_config",stylish:""}),1==t.length&&"string"==typeof t[0].id&&"function"!=typeof t[0].appendChild)var i=t[0];else{i={};for(var n,o=0,s=t.length;o<s;++o)if("function"!=typeof(n=t[o]).appendChild)switch(typeof n){case"object":for(var a in n){if("function"!=typeof n[a]){i.fields=n;break}i.events||(i.events={}),i.events[a]=n[a]}break;case"function":i.events={onOpen:n};break;case"string":/\w+\s*\{\s*\w+\s*:\s*\w+[\s|\S]*\}/.test(n)?i.css=n:i.title=n}else i.frame=n}if(i.id?e.id=i.id:void 0===e.id&&(e.id="GM_config"),i.title&&(e.title=i.title),i.css&&(e.css.stylish=i.css),i.frame&&(e.frame=i.frame),i.events){var r=i.events;for(var c in r)e["on"+c.charAt(0).toUpperCase()+c.slice(1)]=r[c]}if(i.fields){var l=e.read(),d=i.fields,f=i.types||{},u=e.id;for(var h in d){var p=d[h];p?e.fields[h]=new GM_configField(p,l[h],h,f[p.type],u):e.fields[h]&&delete e.fields[h]}}e.id!=e.css.basicPrefix&&(e.css.basic=e.css.basic.replace(new RegExp("#"+e.css.basicPrefix,"gm"),"#"+e.id),e.css.basicPrefix=e.id)}function GM_configDefaultValue(e,t){var i;switch(0==e.indexOf("unsigned ")&&(e=e.substring(9)),e){case"radio":case"select":i=t[0];break;case"checkbox":i=!1;break;case"int":case"integer":case"float":case"number":i=0;break;default:i=""}return i}function GM_configField(e,t,i,n,o){this.settings=e,this.id=i,this.configId=o,this.node=null,this.wrapper=null,this.save=void 0===e.save||e.save,"button"==e.type&&(this.save=!1),this.default=void 0===e.default?n?n.default:GM_configDefaultValue(e.type,e.options):e.default,this.value=void 0===t?this.default:t,n&&(this.toNode=n.toNode,this.toValue=n.toValue,this.reset=n.reset)}GM_configStruct.prototype={init:function(){GM_configInit(this,arguments),this.onInit()},open:function(){var e=document.getElementById(this.id);if(!e||!("IFRAME"==e.tagName||e.childNodes.length>0)){var t=this,i="bottom: auto; border: 1px solid #000; display: none; height: 75%; left: 0; margin: 0; max-height: 95%; max-width: 95%; opacity: 0; overflow: auto; padding: 0; position: fixed; right: auto; top: 0; width: 75%; z-index: 9999;";if(this.frame)this.frame.id=this.id,this.frame.setAttribute("style",i),o(this.frame,this.frame.ownerDocument.getElementsByTagName("head")[0]);else{document.body.appendChild(this.frame=this.create("iframe",{id:this.id,style:i})),this.frame.src="about:blank";var n=this;this.frame.addEventListener("load",(function(e){var i=t.frame;i.src&&!i.contentDocument?i.src="":i.contentDocument||n.log("GM_config failed to initialize default settings dialog node!");var s=i.contentDocument.getElementsByTagName("body")[0];s.id=t.id,o(s,i.contentDocument.getElementsByTagName("head")[0])}),!1)}}function o(e,i){var n=t.create,o=t.fields,s=t.id,a=n("div",{id:s+"_wrapper"});i.appendChild(n("style",{type:"text/css",textContent:t.css.basic+t.css.stylish})),a.appendChild(n("div",{id:s+"_header",className:"config_header block center"},t.title));var r=a,c=0;for(var l in o){var d=o[l],f=d.settings;f.section&&(r=a.appendChild(n("div",{className:"section_header_holder",id:s+"_section_"+c})),"[object Array]"!==Object.prototype.toString.call(f.section)&&(f.section=[f.section]),f.section[0]&&r.appendChild(n("div",{className:"section_header center",id:s+"_section_header_"+c},f.section[0])),f.section[1]&&r.appendChild(n("p",{className:"section_desc center",id:s+"_section_desc_"+c},f.section[1])),++c),r.appendChild(d.wrapper=d.toNode())}a.appendChild(n("div",{id:s+"_buttons_holder"},n("button",{id:s+"_saveBtn",textContent:"Save",title:"Save settings",className:"saveclose_buttons",onclick:function(){t.save()}}),n("button",{id:s+"_closeBtn",textContent:"Close",title:"Close window",className:"saveclose_buttons",onclick:function(){t.close()}}),n("div",{className:"reset_holder block"},n("a",{id:s+"_resetLink",textContent:"Reset to defaults",href:"#",title:"Reset fields to default values",className:"reset",onclick:function(e){e.preventDefault(),t.reset()}})))),e.appendChild(a),t.center(),window.addEventListener("resize",t.center,!1),t.onOpen(t.frame.contentDocument||t.frame.ownerDocument,t.frame.contentWindow||window,t.frame),window.addEventListener("beforeunload",(function(){t.close()}),!1),t.frame.style.display="block",t.isOpen=!0}},save:function(){var e=this.write();this.onSave(e)},close:function(){this.frame.contentDocument?(this.remove(this.frame),this.frame=null):(this.frame.innerHTML="",this.frame.style.display="none");var e=this.fields;for(var t in e){var i=e[t];i.wrapper=null,i.node=null}this.onClose(),this.isOpen=!1},set:function(e,t){this.fields[e].value=t,this.fields[e].node&&this.fields[e].reload()},get:function(e,t){var i=this.fields[e],n=null;return t&&i.node&&(n=i.toValue()),null!=n?n:i.value},write:function(e,t){if(!t){var i={},n={},o=this.fields;for(var s in o){var a=o[s],r=a.toValue();a.save?null!=r?(i[s]=r,a.value=r):i[s]=a.value:n[s]=r}}try{this.setValue(e||this.id,this.stringify(t||i))}catch(e){this.log("GM_config failed to save settings!")}return n},read:function(e){try{var t=this.parser(this.getValue(e||this.id,"{}"))}catch(e){this.log("GM_config failed to read saved settings!");t={}}return t},reset:function(){var e=this.fields;for(var t in e)e[t].reset();this.onReset()},create:function(){if(1===arguments.length)var e=document.createTextNode(arguments[0]);else{e=document.createElement(arguments[0]);var t=arguments[1];for(var i in t)0==i.indexOf("on")?e.addEventListener(i.substring(2),t[i],!1):-1!=",style,accesskey,id,name,src,href,which,for".indexOf(","+i.toLowerCase())?e.setAttribute(i,t[i]):e[i]=t[i];if("string"==typeof arguments[2])e.innerHTML=arguments[2];else for(var n=2,o=arguments.length;n<o;++n)e.appendChild(arguments[n])}return e},center:function(){var e=this.frame;if(e){var t=e.style;t.opacity;"none"==t.display&&(t.opacity="0"),t.display="",t.top=Math.floor(window.innerHeight/2-e.offsetHeight/2)+"px",t.left=Math.floor(window.innerWidth/2-e.offsetWidth/2)+"px",t.opacity="1"}},remove:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},function(){var e,t,i,n,o="undefined"!=typeof GM_getValue&&void 0!==GM_getValue("a","b");o?(e=GM_setValue,t=GM_getValue,i="undefined"==typeof JSON?function(e){return e.toSource()}:JSON.stringify,n="undefined"==typeof JSON?function(e){return new Function("return "+e+";")()}:JSON.parse):(e=function(e,t){return localStorage.setItem(e,t)},t=function(e,t){var i=localStorage.getItem(e);return null==i?t:i},i=JSON.stringify,n=JSON.parse),GM_configStruct.prototype.isGM=o,GM_configStruct.prototype.setValue=e,GM_configStruct.prototype.getValue=t,GM_configStruct.prototype.stringify=i,GM_configStruct.prototype.parser=n,GM_configStruct.prototype.log=window.console?console.log:o&&"undefined"!=typeof GM_log?GM_log:window.opera?opera.postError:function(){}}(),GM_configField.prototype={create:GM_configStruct.prototype.create,toNode:function(){var e=this.settings,t=this.value,i=e.options,n=e.type,o=this.id,s=this.configId,a=e.labelPos,r=this.create;function c(e,t,i,n){switch(n||(n=i.firstChild),e){case"right":case"below":"below"==e&&i.appendChild(r("br",{})),i.appendChild(t);break;default:"above"==e&&i.insertBefore(r("br",{}),n),i.insertBefore(t,n)}}var l,d=r("div",{className:"config_var",id:s+"_"+o+"_var",title:e.title||""});for(var f in e){l=f;break}var u=e.label&&"button"!=n?r("label",{id:s+"_"+o+"_field_label",for:s+"_field_"+o,className:"field_label"},e.label):null;switch(n){case"textarea":d.appendChild(this.node=r("textarea",{innerHTML:t,id:s+"_field_"+o,className:"block",cols:e.cols?e.cols:20,rows:e.rows?e.rows:2}));break;case"radio":var h=r("div",{id:s+"_field_"+o});this.node=h;f=0;for(var p=i.length;f<p;++f){var g=r("label",{className:"radio_label"},i[f]),v=h.appendChild(r("input",{value:i[f],type:"radio",name:o,checked:i[f]==t}));c(!a||"left"!=a&&"right"!=a?"options"==l?"left":"right":a,g,h,v)}d.appendChild(h);break;case"select":h=r("select",{id:s+"_field_"+o});this.node=h;for(f=0,p=i.length;f<p;++f){var _=i[f];h.appendChild(r("option",{value:_,selected:_==t},_))}d.appendChild(h);break;default:var b={id:s+"_field_"+o,type:n,value:"button"==n?e.label:t};switch(n){case"checkbox":b.checked=t;break;case"button":b.size=e.size?e.size:25,e.script&&(e.click=e.script),e.click&&(b.onclick=e.click);break;case"hidden":break;default:b.type="text",b.size=e.size?e.size:25}d.appendChild(this.node=r("input",b))}return u&&(a||(a="label"==l||"radio"==n?"left":"right"),c(a,u,d)),d},toValue:function(){var e=this.node,t=this.settings,i=t.type,n=!1,o=null;if(!e)return o;switch(0==i.indexOf("unsigned ")&&(i=i.substring(9),n=!0),i){case"checkbox":o=e.checked;break;case"select":o=e[e.selectedIndex].value;break;case"radio":for(var s=e.getElementsByTagName("input"),a=0,r=s.length;a<r;++a)s[a].checked&&(o=s[a].value);break;case"button":break;case"int":case"integer":case"float":case"number":var c=Number(e.value),l='Field labeled "'+t.label+'" expects a'+(n?" positive ":"n ")+"integer value";if(isNaN(c)||"int"==i.substr(0,3)&&Math.ceil(c)!=Math.floor(c)||n&&c<0)return alert(l+"."),null;if(!this._checkNumberRange(c,l))return null;o=c;break;default:o=e.value}return o},reset:function(){var e=this.node,t=this.settings.type;if(e)switch(t){case"checkbox":e.checked=this.default;break;case"select":for(var i=0,n=e.options.length;i<n;++i)e.options[i].textContent==this.default&&(e.selectedIndex=i);break;case"radio":var o=e.getElementsByTagName("input");for(i=0,n=o.length;i<n;++i)o[i].value==this.default&&(o[i].checked=!0);break;case"button":break;default:e.value=this.default}},remove:function(e){GM_configStruct.prototype.remove(e||this.wrapper),this.wrapper=null,this.node=null},reload:function(){var e=this.wrapper;e&&(e.parentNode.insertBefore(this.wrapper=this.toNode(),e),this.remove(e))},_checkNumberRange:function(e,t){var i=this.settings;return"number"==typeof i.min&&e<i.min?(alert(t+" greater than or equal to "+i.min+"."),null):!("number"==typeof i.max&&e>i.max)||(alert(t+" less than or equal to "+i.max+"."),null)}};var GM_config=new GM_configStruct;